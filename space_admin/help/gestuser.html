<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <title>Civil-Records | Aide</title>
    <link rel="shortcut icon" href="../../assets/img/favicon.ico" type="image/x-icon">
    <link media="screen" rel="stylesheet" href="./actes_aide.css" type="text/css">
</head>

<body>
    <h1> Expoactes : Administrer les comptes utilisateurs</h1>
    <p><a href="aide.html">Retour à la liste des fichiers
            d'aide</a><br>
    </p>
    <p>La gestion des utilisateurs est très importante pour
        définir qui peut faire quoi sur la base de données
        publiée grâce à ExpoActes. Le module de gestion des
        utilisateurs n'est accessible qu'à l'administrateur qui peut y
        effectuer les opérations suivantes :</p>
    <ul>
        <li>Créer, modifier ou supprimer individuellement des comptes
            d'utilisateur;</li>
        <li>Créer un liste d'utilisateurs par importation d'un fichier CSV;</li>
        <li>Exporter une liste d'utilisateur et supprimer éventuellement
            ceux-ci;</li>
        <li>Envoyer un e-mail d'information à un ensemble d'utilisateurs;</li>
        <li>Modifier globalement les dates d'échéance des compte et
            les soldes de points affectés à un ensemble
            d'utilisateurs. </li>
    </ul>
    <p>La possibilité peut être ouverte aux visiteurs pour
        créer eux-même leur compte d'utilisateur avec
        vérification de la validité de l'adresse e-mail, protection
        anti-spam par captcha et approbation éventuelle par
        l'administrateur.</p>
    <p>Un dispositif a également été ajouté
        permettant de <span style="font-weight: bold;">gérer un "compte"
            de points</span> pour chaque utilisateur enregistré. Ce compte,
        qui peut être réapprovisionné de manière
        automatisée, permet ainsi de <strong>limiter le nombre d'actes
            détaillés visionnés par un utilisateur</strong> au
        cours d'une période donnée. </p>
    <p>Ces différentes possiblités sont activables grâce
        à <a href="config.html#Utilisateurs">plusieurs paramètres
            globaux "Utilisateurs"</a>. </p>
    <p>Toutes les opérations sur les comptes des utilisateurs sont
        accessibles via l'item <strong>Administrer les utilisateurs</strong> du
        menu d'administration. Ces actions nécessitent le niveau
        d'accès 9.</p>
    <p>A partir de la version 3.1, prenant en compte le fait que plusieurs
        associations utilisatrices du logiciel organisent les actes dans deux
        bases ou plus, il est apparu nécessaire de faciliter la gestion des
        comptes utilisateurs en centralisant la gestion de ceux-ci dans une seule
        des bases et de faire obéir les autres bases à la
        première base. La titre ci-dessous <strong><a href="#Centraliser">Centraliser
                la gestion des utilisateurs pour plusieurs bases</a></strong> donne la
        procédure à employer et les contraintes de cette solution.</p>
    <h3> Niveau d'accès des utilisateurs </h3>
    Chaque code de login est affecté d'un niveau d'accès qui
    lui donne accès aux tâches de son niveau et à toutes
    celles des niveaux inférieurs.<br>
    Les niveau d'accès suivants sont définis :<br>
    <ul>
        <li>1 = Accès à la liste des communes et paroisses  </li>
        <li>2 = Accès à la listes des patronymes (par
            commune/paroisse et par type d'acte) ainsi qu'à la distribution
            des dates (si activé) </li>
        <li>3 = Accès aux tables (noms et dates) </li>
        <li>4 = Accès aux détails des actes (avec
            limitation IP et par points, si activées)</li>
        <li>5 = Accès aux détails des actes (sans limitation par
            adresse IP, mais avec limitation par points) *</li>
        <li>6 = Autorisé à charger des données de type
            NIMEGUE ou CSV (Excel) * </li>
        <li>7 = Autorisé à l'ajout d'actes individuels </li>
        <li>8 = Autorisé à gérer toutes les données </li>
        <li>9 = Administrateur (y compris gestion des utilisateurs) </li>
    </ul>
    <p>* A partir de la version 3.2, les anciens niveaux 5 et 6 ont
        été fusionnés en 6, libérant ainsi le niveau 5
        pour les accès privilégiés sans limitation par
        adresse IP.</p>
    <p>Le paramètre général (PUBLIC_LEVEL) permet d'ouvrir
        l'accès public jusqu'à un niveau déterminé
        à partir duquel la fenêtre de login apparaît. Par
        défaut, il est réglé au niveau 4 qui
        laisse l'accès libre en consultation des tables et des actes
        mais les protège de toute modification.<br>
    </p>
    <h3> Création et édition des fiches d'utilisateurs</h3>
    <p>Dans une fiche d'utilisateur, le nom et prénom de la personnes
        sont évidemment obligatoires. Le code de login compte au minimum 3
        caractères tandis que le mot de passe doit en compter au moins 6.
        Le symbole apostrophe est cependant interdit. </p>
    <p>Le compte doit aussi préciser une adresse email valide et, en
        principe, unique. Cette unicité peut en effet être un
        problème lorsque plusieurs utilisateurs partagent une même
        adresse mail. Un paramètre a donc été ajouté
        pour lever cette contrainte là ou c'est nécessaire. </p>
    <p><span style="font-weight: bold;">Mot de passe automatique</span> : Si
        cette case est cochée, ExpoActes génère un mot de
        passe aléatoire comprenant des lettres et des chiffres. Sauf
        configuration contraire (voir paramètre CHANGE_PW), l'utilisateur
        pourra changer lui-même ce mot de passe par un code plus facile
        à mémoriser pour lui.</p>
    <p>Chaque compte précise le niveau d'accès de l'utilisateur
        ainsi que <strong>le statut du compte</strong>. Pour qu'un compte soit
        opérationnel, le statut doit être "N" (Normal), valeur par
        défaut lors de la création individuelle du compte ou de la
        création par importation d'une liste. Il est aussi possible
        d'interdir l'accès du site à un compte en basculant le
        statut sur "B" pour Bloqué. Les deux autres statuts possibles ne
        sont utiles que lors de l'auto-enregistrement des utilisateurs. </p>
    <p>Enfin, à partir de la version 3, un compte est aussi
        associé à une date d'échance. Cela veut dire que
        lorsque cette date est dépassée, le compte est bloqué
        et l'utilisateur ne peut se connecter. Il est par contre possible à
        l'adminsitrateur de préciser une nouvelle date
        d'échéance. Par défaut, la date d'échance des
        comptes est fixée à la fin de l'année 2033 ce qui
        équivaut à dire que ces comptes sont illimités dans
        le temps. Un paramètre permet de spécifier une autre date
        par défaut ou un délai qui est alors compté à
        partir du jour de création du compte.</p>
    <p>Notons aussi qu'à partir de la version 3, les mots de passe ne
        sont plus stockés que sous forme "hashée" dans la base de
        données. Cela signifie que cette valeur codée sur 40
        caractères (quel que soit la longueur du mot de passe original)
        permet de VERIFIER que le mot de passe introduit pas l'utilisateur est
        valide mais ne permet pas de RECONSTITUER le mot de passe et donc il est
        devenu impossible de renvoyer le mot de passe oublié à un
        utilisateur. A la place, le système génère un nouveau
        mot de passe et l'envoie à l'utilisateur qui peut
        éventuellement le modifier à sà guise. Cette
        façon de faire permet de protéger les mots de passe de tous
        les utilisateurs contre toute utilisation malveillante et augmente donc le
        niveau de sécurisation du logiciel. </p>
    <h3> E-mail d'envoi des codes d'accès </h3>
    Si la case "Envoi des codes d'accès" est cochée (et que <a href="config.html#Mail">les
        paramètres de gestion des courriers électronique</a>
    sont  bien configurés !)  Expoactes expédie
    automatiquement un petit e-mail à l'adresse de l'utilisateur
    mentionnant le login et le mot de passe attribué.<br>
    <br>
    Le texte du mail peut être modifié à votre convenance en
    veillant cependant à conserver les codes #LOGIN# et #PASSW# qui
    seront automatiquement remplacés par les codes ad hoc avant envoi. De
    plus le code #URLSITE#  permet l'affichage de l'URL du site pour que
    l'utilisateur puisse se connecter immédiatement.  Ce texte doit
    cependant rester relativement court.<br>
    Vous pouvez aussi utiliser #NOM# et #PRENOM# pour personnaliser le message.<br>
    <br>
    Le texte par défaut peut être modifié via les <a href="config.html#TEXTESMAIL">paramètres
        mail</a>.<br>
    <br>
    <h3> Importer en masse des utilisateurs via un fichier CSV ou restaurer un
        backup</h3>
    Dans les associations, il peut être nécessaire de créer
    des centaines de codes d'utilisateurs. Pour faciliter cette tâche il
    est possible d'importer un fichier créé avec un tableur qui
    contienne au minimum les nom, prénom et adresse e-mail des
    utilisateurs à créer.  Il est aussi possible de
    préciser le login demandé, le mot de passe et les autres
    paramètres mais ces données peuvent aussi être
    générées automatiquement par le logiciel.<br>
    <br>
    Dans tous les cas, le fichier doit être enregistré au format
    CSV avec des ; (point-virgule) comme séparateur.<br>
    <br>
    Le détail du format est le suivant :<br>
    <br>
    <div style="text-align: center;"> <span style="font-weight: bold;">Fichier
            utilisateurs</span><br>
    </div>
    <table style="text-align: left;" summary="Fichier utilisateurs" cellpadding="2" cellspacing="2">
        <tbody class="row0">
            <tr class="rowheader">
                <th> Colonne </th>
                <th style="text-align: center;"> Contenu </th>
                <th style="text-align: center;"> Remarque </th>
            </tr>
            <tr>
                <td style="text-align: center;"> 1 A </td>
                <td> Nom de l'utilisateur </td>
                <td> Obligatoire </td>
            </tr>
            <tr>
                <td style="text-align: center;"> 2 B </td>
                <td> Prénom </td>
                <td> Obligatoire </td>
            </tr>
            <tr>
                <td style="text-align: center;"> 3 C </td>
                <td> Adresse e-mail </td>
                <td> Obligatoire </td>
            </tr>
            <tr>
                <td style="text-align: center;"> 4 D </td>
                <td> Login demandé </td>
                <td> "auto" si création automatique<br>
                </td>
            </tr>
            <tr>
                <td style="text-align: center;"> 5 E </td>
                <td> Mot de passe proposé </td>
                <td> "auto" si création automatique </td>
            </tr>
            <tr>
                <td style="text-align: center;"> 6 F </td>
                <td> Niveau d'accès  </td>
                <td> 1 à 8, voir ci-dessus </td>
            </tr>
            <tr>
                <td style="text-align: center;"> 7 G </td>
                <td> Régime </td>
                <td> 0 à 2 (si gestion des points) </td>
            </tr>
            <tr>
                <td style="text-align: center;"> 8 H </td>
                <td> Solde initial de points </td>
                <td> <br>
                </td>
            </tr>
            <tr>
                <td style="text-align: center;">9 I </td>
                <td>Commentaire</td>
                <td>Commentaire facultatif </td>
            </tr>
            <tr>
                <td style="text-align: center;">10 J </td>
                <td>Date d'expiration </td>
                <td> </td>
            </tr>
            <tr>
                <td style="text-align: center;">11 K </td>
                <td>Libre</td>
                <td>Information libre </td>
            </tr>
            <tr>
                <td style="text-align: center;"> 12 L </td>
                <td> Identifiant</td>
                <td> (uniquement pour backup/restauration)</td>
            </tr>
            <tr>
                <td style="text-align: center;"> 13 M </td>
                <td> Statut du compte</td>
                <td> N=Normal / B=Bloqué</td>
            </tr>
            <tr>
                <td style="text-align: center;"> 14 N </td>
                <td> Date d'inscription</td>
                <td>Automatique sauf si restauration</td>
            </tr>
            <tr>
                <td style="text-align: center;"> 15 O </td>
                <td> Points consommés</td>
                <td> (en principe 0 si import)</td>
            </tr>
            <tr>
                <td style="text-align: center;"> 16 P </td>
                <td> Date de recharge</td>
                <td> Automatique sauf si restauration</td>
            </tr>
        </tbody>
    </table>
    <div></div>
    <div></div>
    <p><span style="font-weight: bold;"><br>
        </span> Exemples :<br>
        "Lambert";"Pascale";"lambertp@free.net";"pascale";"auto";6;1;120;"2006"<br>
        Martin;Jean;mjean@gmail.com<br>
        <br>
        Si la zone 4 (login) est vide ou marquée "auto", le logiciel
        génère un login automatiquement en prenant les 3 premiers
        caractères du prénom suivi des 3 premiers du nom puis,
        si nécessaire, d'un code en deux chiffres lorsque le login est
        déjà utilisé (exemple avec le 2ème cas
        ci-dessus : "jeamar" puis si nécessaire "jeamar01",
        "jeamar02", ...)<br>
        <br>
        Si la zone 5 (mot de passe) est vide ou marquée "auto", le logiciel
        génère un mot de passe aléatoire composé de
        lettres et de chiffres.  Notons que chaque utilisateur peut changer
        son mot de passe après s'être connecté au moins une
        fois avec le mot de passe qui lui a été attribué.<br>
        <br>
        Si les zones 6 et 7 (niveau d'accès et régime de gestion des
        points) n'ont pas été spécifiées, alors le
        système attribue le niveau et le régime par défaut
        qui auront été spécifié dans le formulaire de
        chargement.<br>
        <br>
        La zone 8 (solde initial) permet d'affecter un nombre de point de
        départ. Cette option n'est utile que pour l'affectation manuelle
        des points (régime = 1).
    </p>
    <p>Les zones 10 et 11 sont nouvelles à la version 3. Elles sont
        facultatives. </p>
    <p>La zone 12 (Identifiant) permet de forcer un n&deg; identifiant. C'est
        particulièrement important lors de l'usage de l'importation pour
        restaurer des données sauvegardées. Idem pour les zones 13
        à 16 qui permettent de restaurer des données. <strong>Ces
            zones 12 à 16 ne doivent pas être complétées
            lors des imports de nouveaux utilisateurs. </strong></p>
    <h3>Exporter et (éventuellement supprimer) des comptes utilisateurs
        ou faire un backup</h3>
    <p>En complément à l'importation, il peut être utile,
        surtout pour les associations, de supprimer un lot de comptes utilisteurs
        ou de les exporter pour mettre à jour les données via un
        outil externe (Excel, Access,...). </p>
    <p>Par précaution, il n'est pas possible de supprimer un lot de
        comptes sans exporter les valeurs qui seront supprimées. Il est
        ainsi toujours possible de réimporter ces comptes par la suite.</p>
    <p>La procédure impose de préciser le niveau d'accès
        des comptes à supprimer. Par sécurité, il n'est
        toutefois pas possible de supprimer les comptes des administrateurs. Il
        est aussi possible de compléter la sélection en
        précisant le "régime" lorsque la gestion de points est
        activées. Enfin, il est aussi possible de spécifier un
        morceau de texte qui sera recherché dans le commentaire
        associé aux utilisateurs. Il est aussi possible de
        sélectionner un statut particulier. c'est utilenotamment pour
        supprimer des comptes qui ont expirés depuis un nombre de jours
        fixé dans le paramètre DUREE_EXPIR. Cela évite de
        laisser subsister des comptes dormants et de toute façon
        inutilisables. Le paramètre peut être modifié dans la
        section "Uitlisateurs" des paramètres.</p>
    <p><strong>Pour réaliser un backup de l'ensemble des comptes
            utilisateurs</strong>, il suffit de sélectionner "*** Tous
        &gt;&gt;&gt; Backup ***" dans la zone niveau. </p>
    <h3>Envoi d'un mail circulaire</h3>
    <p>Cette fonction permet d'envoyer un courrier à tout ou partie des
        utilisateurs. </p>
    <p>Elle dépend cependant des possibilités d'envoi offertes par
        l'hébergeur. En effet, certains hébergeurs limitent le
        nombre de mails pouvant être expédiés par unité
        de temps et dans ce cas, il est fort possible qu'une partie des
        utilisateurs ne reçoivent jamais la mail envoyé. </p>
    <p>Avant l'envoi, il faut préciser un niveau d'accès (ou A =
        Tous) et éventuellement le régime de gestion de points et/ou
        une condition sur le commentaire associé à l'utilisateur.
        Ceci permet par exemple de noter des codes dans le commentaire et de s'en
        servir pour sélectionner les destinataires.</p>
    <p>Pour l'envoi du mail, il suffit de compléter le sujet et le texte,
        puis d'envoyer. </p>
    <h3>Modifications groupées et ajustement des soldes</h3>
    <p>Quelques modifications sur les comptes des utilisateurs sont succeptibles
        de devoir être faite sur des groupes important de comptes. Il s'agit
        notamment de l'affectation d'une nouvelle date d'expiration ou l'ajout de
        points aux soldes des comptes. </p>
    <p>Comme pour l'envoi des mails circulaires, il faut préciser un
        niveau d'accès et éventuellement le régime de gestion
        de points et/ou une condition sur le commentaire associé à
        l'utilisateur. Ceci permet par exemple de noter des codes dans le
        commentaire et de s'en servir pour sélectionner les destinataires.
        On peut aussi ajouter une condition sur la date actuelle d'expiration du
        compte. </p>
    <p>Pour la gestion des dates d'expiration, il faut préciser la
        nouvelle date qui sera affectée. Pour la gestion des soldes, on a
        le choix entre "ajouter" un nombre de points à tous les
        utilisateurs concernés ou d'affecter d'office un nombre de point
        quelque soit le solde précédent. </p>
    <p><strong>Précaution importante :</strong> Avant toute modification
        groupée, il est prudent de réaliser un export backup des
        comptes utilisateurs. De cette façon, en cas d'erreur, il sera
        possible de supprimer puis de restaurer les comptes incorrectement
        modifiés. </p>
    <h3>Chargement d'actes pour le compte d'autres utilisateurs</h3>
    <p>Dans les associations, il arrive souvent que le chargement des actes soit
        effectué par un seul administrateur bien que les
        dépouillements soient assurés par de nombreuses personnes.
        Pour garder trace des dépouillements effectués par les
        différents membres, il est possible - pour les administrateurs
        seulement - de désigner le déposant "titulaire" bien que le
        travail soit effectivement réalisé par l'administrateur.</p>
    <p>A cette fin, les administrateurs (ayant le niveau 8 ou 9) trouvent une
        boîte de sélection supplémentaire dans les
        écrans de chargement des actes CSV ou NIMEGUES. Cette boîte
        de sélection propose la liste des utilisateurs ayant un niveau
        d'accès spécifié par le paramètre
        DEPOSANT_LEVEL ou supérieur. Il suffit d'y sélectionner le
        nom de la personne ayant effectivement réalisé le
        dépouillement.</p>
    <p>De cette façon, cette personne aura aussi le
        possibilité de corriger les actes qu'elle a (ou est sensée
        avoir) déposé et ceux-là seulement.</p>
    <h3><strong><a name="Centraliser"></a>Centraliser la gestion
            des utilisateurs pour plusieurs bases</strong></h3>
    <p>Si pour une raison quelconque, on souhaite répartir
        les actes dans deux bases ou plus (avec donc des adresses web distinctes),
        il est possible de faciliter la gestion des comptes utilisateurs en
        centralisant la gestion de ceux-ci dans une seule des bases (dite base
        Principale) et de faire obéir les autres bases (bases secondaires)
        à la base principale. En fait, il n'existe plus qu'une seule table
        d'utilisateurs (active*) pour toutes les bases. </p>
    <p>Cette disposition a les conséquences suivantes :</p>
    <ul>
        <li>Ce sont exactement les mêmes utilisateurs qui sont
            habilités à visiter et/ou gérer les
            différentes bases. Il n'est pas possible de spécifier
            qu'un utilisateur est lié à une base particulière.
        </li>
        <li>L'ajout d'un utilisateur via une base (notamment via le formulaire
            public de création de compte) le rend immédiatement
            disponible dans les autres bases. La suppression, le blocage ou
            l'expiration de son compte est également valable pour toutes les
            bases.</li>
        <li>Le changement de mot de passe d'une compte via n'importe quelle base
            est aussi effectif pour les autres bases. </li>
        <li>Il n'existe pour un utilisateur donné qu'un seul solde de
            points. La consommation de ces points s'effectue dans n'importe quelle
            base, pour autant que la gestion des points y soit activée. Il
            est donc possible d'avoir une base qui ne décompte pas les points
            consommés et une autre qui les décompte selon les
            paramètres de gestion de chacune des bases.</li>
    </ul>
    <p>En pratique, sur la base principale on ne note aucun
        changement et il est même impossible de savoir que cette base
        fournit le service d'authentification à d'autres bases. Si l'on
        souhaite faire un backup des utilisateurs ou toute autre manipulation
        importante (suppression de plusieurs comptes, export, modification
        groupée, c'est sur cette base qu'il faut le faire car ces fonctions
        ne sont pas accessibles dans les bases secondaires.</p>
    <p>Dans chacune des bases secondaire, il faut ajouter au
        fichier BD-...-connect.inc.php les codes d'accès vers la base principale
        afin que celle-ci soit consultée en lieu et place de la table des
        utilisateurs de la base courante. Pour ce faire il faut ajouter les
        variables suivantes (toujours) et éventuellement la
        définition de la constante EA_DBU :</p>
    <blockquote>
        <p><code>$udbaddr = "wwwwwww"; // Adresse du serveur pour la
          base des utilisateurs<br>
          $udbname = "xxxxxxx"; // Nom de la base<br>
          $udbuser = "yyyyyyy"; // Login MySQL-EasyPHP<br>
          $udbpass = "zzzzzzz"; // Mot de passe<br>
          define("EA_UDB","act"); //préfixe des tables</code></p>
    </blockquote>
    <p>Il convient bien évidemment de remplacer les valeurs
        par les codes d'accès fournis par l'hébergeur. En pratique,
        il suffit de copier les valeurs déjà présentes dans
        la base principale : faire un copier coller du bloc puis ajouter un "u"
        juste après le $ dans le nom des 4 variables.</p>
    <p>Dans le cas o&ugrave; il n'existe qu'une seule base MySQL et
        que les deux "bases" sont distinguées via un préfixe, il
        faut malgré tout spécifier ces 4 variables mais en plus, il
        faut préciser le préfixe des tables de la base principale. </p>
    <p>Il est judicieux de régler les paramètres
        "Utilisateurs" des bases secondaires de façon identique ou en tous
        cas compatible avec les paramètres de la base principale. Un rappel
        est affiché en tête de ces paramètres pour inviter
        à la prudence dans la gestion de ces valeurs. De même, la
        gestion des utilisateurs est limitée dans les bases secondaires au
        listage des utilisateur et à la modification individuelle des
        fiches. </p>
    <p>(*) En pratique, la tables des utilisateurs des bases
        secondaire n'est jamais supprimée mais elle n'est pas
        consultée. Il ne faut cependant pas la supprimer car elle est
        utilisée lors des mise à jour du logiciel et peut facilement
        être réactivée en cas de besoin. </p>
    <h3> <br>
        <br>
        <a href="aide.html">Retour à la liste des fichiers d'aide</a>
    </h3>
</body>

</html>